from datetime import datetime

import helpers
import objects
import stages

from experiment import get_current_experiment


def get_current_stages():
  experiment = get_current_experiment()
  if not experiment:
    return []

  previous_commit = COMMIT_LIST[0][0]
  base_snapshot_name = helpers.SnapshotName(previous_commit, "src")
  assert objects.Snapshot.load(base_snapshot_name).ready(), '%s must exist' % base_snapshot_name

  current_stages = []
  for current_commit, commit_time in COMMIT_LIST[1:]:
    logging.debug('commit: %s' % (commit_time - COMMIT_LIST_START))
    logging.debug('elapsed: %s' % experiment.elapsed())
    if commit_time - COMMIT_LIST_START > experiment.elapsed():
      break
    current_stages.append(stages.SyncStage(previous_commit, current_commit))
    current_stages.append(stages.BuildStage(None, current_commit))
    previous_commit = current_commit
  return current_stages


def parse_time(time_string):
  return datetime.strptime(time_string, '%Y-%m-%d %H:%M:%S')


COMMIT_LIST_START = parse_time('2015-01-21 00:00:00')
COMMIT_LIST = (
  ('4108ce09f9ead01f', parse_time('2015-01-21 00:06:33')),
  ('4220eea6d0c7ffa9', parse_time('2015-01-21 00:21:22')),
  ('a9f61f02eb555b0b', parse_time('2015-01-21 00:23:12')),
  ('7f17a7758881aa33', parse_time('2015-01-21 00:53:21')),
  ('aa928ff8aa04cba9', parse_time('2015-01-21 00:58:34')),
  ('045c9bf1d36f3564', parse_time('2015-01-21 06:05:23')),
  ('090a00e7ff8c5fb1', parse_time('2015-01-21 11:05:05')),
  ('d6552661356cafdc', parse_time('2015-01-21 11:06:44')),
  ('2935666ed30c24a2', parse_time('2015-01-21 11:06:45')),
  ('a78fa6fc306c6f49', parse_time('2015-01-21 11:09:09')),
  ('c514ed05c61d4228', parse_time('2015-01-21 11:09:10')),
  ('6febb4ef7865fada', parse_time('2015-01-21 11:09:11')),
  ('21b128297b19076f', parse_time('2015-01-21 11:10:51')),
  ('ae8bda577e76b4e3', parse_time('2015-01-21 11:10:52')),
  ('faf8b453fa03869b', parse_time('2015-01-21 11:27:16')),
  ('6f4aa7e2069231cb', parse_time('2015-01-21 11:44:36')),
  ('4359db72cde4fe4e', parse_time('2015-01-21 12:40:49')),
  ('9d533c4211e366ed', parse_time('2015-01-21 12:42:14')),
  ('6154ce77f15a68c8', parse_time('2015-01-21 12:45:58')),
  ('281667e0bdcde1e4', parse_time('2015-01-21 12:45:59')),
  ('2c5518d7b7d3eb11', parse_time('2015-01-21 13:13:46')),
  ('c497f3788bc5007e', parse_time('2015-01-21 13:40:30')),
  ('275932c2d51cb9e1', parse_time('2015-01-21 13:46:28')),
  ('368d94621cb29485', parse_time('2015-01-21 13:54:50')),
  ('ae1a91dab26b089c', parse_time('2015-01-21 13:56:15')),
  ('ed8d899eb98bfe38', parse_time('2015-01-21 13:57:49')),
  ('b3f95493b4dcd134', parse_time('2015-01-21 13:57:50')),
  ('22a80e71d7199d9d', parse_time('2015-01-21 13:59:11')),
  ('678686d7440e28b1', parse_time('2015-01-21 13:59:12')),
  ('a39cae03de3894cd', parse_time('2015-01-21 14:03:24')),
  ('f0c11866899ffd0b', parse_time('2015-01-21 14:03:25')),
  ('4cf3535f639fe037', parse_time('2015-01-21 14:03:26')),
  ('52f6146bdbd80b89', parse_time('2015-01-21 14:03:27')),
  ('1d47a35e40040daf', parse_time('2015-01-21 14:03:28')),
  ('402e5206669870c1', parse_time('2015-01-21 14:03:29')),
  ('81197b2560fae7c1', parse_time('2015-01-21 14:05:12')),
  ('035125910439fc66', parse_time('2015-01-21 14:05:13')),
  ('d8c057d71ae5062b', parse_time('2015-01-21 14:06:40')),
  ('50f9c8e35e788b65', parse_time('2015-01-21 14:08:11')),
  ('cf03eb0c4b236143', parse_time('2015-01-21 14:08:12')),
  ('dcbf4aabe86ac33d', parse_time('2015-01-21 14:09:45')),
  ('f555fec2b8769deb', parse_time('2015-01-21 14:09:46')),
  ('0eeb6a9a3b410797', parse_time('2015-01-21 14:11:14')),
  ('e0f868e9bb4f5ca5', parse_time('2015-01-21 14:11:15')),
  ('b43e6cc69ecb0049', parse_time('2015-01-21 14:12:36')),
  ('d0a0c992fc0eb9c8', parse_time('2015-01-21 14:14:29')),
  ('e0abded3fd525ff0', parse_time('2015-01-21 14:14:30')),
  ('d7e021d86cd234f8', parse_time('2015-01-21 14:16:07')),
  ('eb1f1be18cdec48c', parse_time('2015-01-21 14:16:08')),
  ('dadaac36b84938d9', parse_time('2015-01-21 14:17:52')),
  ('cbe97a623786ec36', parse_time('2015-01-21 14:17:53')),
  ('dad6da460d13947b', parse_time('2015-01-21 14:17:54')),
  ('49c6e74138dc5f81', parse_time('2015-01-21 14:19:21')),
  ('465662ed7e306369', parse_time('2015-01-21 14:20:52')),
  ('dcd1e0f17a992eb2', parse_time('2015-01-21 14:20:53')),
  ('4b9c17e27d575055', parse_time('2015-01-21 14:22:21')),
  ('183ce6363d441d4d', parse_time('2015-01-21 14:22:22')),
  ('c7971906db1f36ad', parse_time('2015-01-21 14:23:56')),
  ('8a516c4f82192361', parse_time('2015-01-21 14:23:57')),
  ('6d5ce7f1c3c11516', parse_time('2015-01-21 14:25:55')),
  ('0a2a1898d00213dc', parse_time('2015-01-21 14:25:56')),
  ('5a388d809868ec83', parse_time('2015-01-21 14:27:30')),
  ('8d6edba93eabb174', parse_time('2015-01-21 14:27:31')),
  ('d892fde82106439d', parse_time('2015-01-21 14:28:58')),
  ('9f83dd3a3c48f3b0', parse_time('2015-01-21 14:28:59')),
  ('77abcf7d289ec445', parse_time('2015-01-21 14:30:31')),
  ('956993f22a92339f', parse_time('2015-01-21 14:30:32')),
  ('0dc6c55b60d7593d', parse_time('2015-01-21 14:32:05')),
  ('57988d1f46e6ce2a', parse_time('2015-01-21 14:33:46')),
  ('f4bdb54c848a8152', parse_time('2015-01-21 14:35:58')),
  ('351519fd09084647', parse_time('2015-01-21 14:35:59')),
  ('557114ed77022971', parse_time('2015-01-21 14:36:00')),
  ('d7ce058384dd9226', parse_time('2015-01-21 14:38:16')),
  ('0539f2f5214fc17f', parse_time('2015-01-21 14:38:17')),
  ('05b2c7ba7ea3bd77', parse_time('2015-01-21 14:40:00')),
  ('e97add26342fadfb', parse_time('2015-01-21 14:40:01')),
  ('ef0ffb7c3d8532fa', parse_time('2015-01-21 14:41:44')),
  ('24a0f3a78b2bc83f', parse_time('2015-01-21 14:41:45')),
  ('8910d20fdabea7c0', parse_time('2015-01-21 14:41:46')),
  ('df59d8f077f7541b', parse_time('2015-01-21 14:43:14')),
  ('ec410fc086b7bad2', parse_time('2015-01-21 14:44:41')),
  ('a13d9af247043eaf', parse_time('2015-01-21 14:44:42')),
  ('b6624b457c5fd667', parse_time('2015-01-21 14:46:12')),
  ('1a77411405391fa9', parse_time('2015-01-21 14:46:13')),
  ('0d264850d7d8b983', parse_time('2015-01-21 14:47:42')),
  ('9bbad24aa9990d23', parse_time('2015-01-21 14:47:43')),
  ('8862ce36105a75af', parse_time('2015-01-21 14:49:33')),
  ('97dc995002ed64b0', parse_time('2015-01-21 14:49:34')),
  ('38a6fabc90e33b04', parse_time('2015-01-21 15:18:56')),
  ('e98e8e7654b7e51f', parse_time('2015-01-21 15:26:40')),
  ('f752426485290ebf', parse_time('2015-01-21 15:28:39')),
  ('99d4c15b5ac4dd32', parse_time('2015-01-21 15:31:11')),
  ('cd3a95252fc67e46', parse_time('2015-01-21 15:41:11')),
  ('e55e9aabcb12008a', parse_time('2015-01-21 15:42:46')),
  ('063efcf45e7d9ea6', parse_time('2015-01-21 15:56:53')),
  ('fb5251d1ff4f36ea', parse_time('2015-01-21 15:58:20')),
  ('3f7a8d0427d48ddd', parse_time('2015-01-21 16:42:45')),
  ('99273f63af064e8e', parse_time('2015-01-21 17:14:06')),
  ('3df4b87b4bb419d8', parse_time('2015-01-21 19:51:12')),
  ('612dc5e5e6b287ec', parse_time('2015-01-21 19:55:34')),
  ('97a646ae131c24ce', parse_time('2015-01-21 19:57:04')),
  ('d733ef8b689ed772', parse_time('2015-01-21 19:58:36')),
  ('b1f519c37f766377', parse_time('2015-01-21 19:58:37')),
  ('e8043e53867a334b', parse_time('2015-01-21 20:00:11')),
  ('b2514129e3a9d696', parse_time('2015-01-21 20:12:51')),
  ('7df36b27afc2da12', parse_time('2015-01-21 20:14:22')),
  ('0458a61127a58dc6', parse_time('2015-01-21 20:16:22')),
  ('91ff1e3964c0d2c4', parse_time('2015-01-21 20:16:23')),
  ('f714289259132eb6', parse_time('2015-01-21 20:16:24')),
  ('d4ef11808ce81d02', parse_time('2015-01-21 20:17:58')),
  ('0ccd70c6f3fa1bf5', parse_time('2015-01-21 20:17:59')),
  ('92da739316361e17', parse_time('2015-01-21 20:19:32')),
  ('515812f023528794', parse_time('2015-01-21 20:19:33')),
  ('04e509c9db0ad64e', parse_time('2015-01-21 20:20:57')),
  ('950f0d49b0157ed4', parse_time('2015-01-21 20:22:22')),
  ('07a8e92fb99ff032', parse_time('2015-01-21 20:22:23')),
  ('3a8ce9fdae852cfa', parse_time('2015-01-21 20:23:49')),
  ('4671a458da766f19', parse_time('2015-01-21 20:23:50')),
  ('57b2c6c8543cc5b2', parse_time('2015-01-21 20:25:11')),
  ('c1a91a8a6a7132c4', parse_time('2015-01-21 20:27:17')),
  ('9b9d2e0a172bf3c3', parse_time('2015-01-21 20:27:18')),
  ('a0a8384802be386f', parse_time('2015-01-21 20:28:52')),
  ('2abacff7ad83e48d', parse_time('2015-01-21 20:28:53')),
  ('d724e7bcc7b15109', parse_time('2015-01-21 20:30:20')),
  ('1bb3d1d4a9d51553', parse_time('2015-01-21 20:31:50')),
  ('ae98daac90e8a97f', parse_time('2015-01-21 20:31:51')),
  ('603647627bf638b6', parse_time('2015-01-21 20:33:21')),
  ('0b332db0581b1381', parse_time('2015-01-21 20:33:22')),
  ('21959d33ba15f4e4', parse_time('2015-01-21 20:35:07')),
  ('52cfea1ccce19c42', parse_time('2015-01-21 20:35:08')),
  ('20419e404d3a7a49', parse_time('2015-01-21 20:36:45')),
  ('bd2e01dd0860762c', parse_time('2015-01-21 20:36:46')),
  ('ed24b6f85f73b2a5', parse_time('2015-01-21 20:39:54')),
  ('af7073b5633518bc', parse_time('2015-01-21 20:39:55')),
  ('afbf7f097f96b0de', parse_time('2015-01-21 20:39:56')),
  ('ceeb4976a531646f', parse_time('2015-01-21 20:39:57')),
  ('c46ccfb7031ebf01', parse_time('2015-01-21 20:41:45')),
  ('1e511856ab4e7bf1', parse_time('2015-01-21 20:41:46')),
  ('9e614a242c34f760', parse_time('2015-01-21 20:43:18')),
  ('5ce2ee76f1512eda', parse_time('2015-01-21 20:43:19')),
  ('bdf05a13f9723f12', parse_time('2015-01-21 20:44:49')),
  ('7d3d8bceeac97d0a', parse_time('2015-01-21 20:44:50')),
  ('e587c6d4dd88d910', parse_time('2015-01-21 20:46:23')),
  ('e16def6f1ddbc987', parse_time('2015-01-21 20:48:09')),
  ('4f0c73e6744b9a73', parse_time('2015-01-21 20:48:10')),
  ('5ea0476b1f36f667', parse_time('2015-01-21 20:49:45')),
  ('2598c69a3c184095', parse_time('2015-01-21 20:49:46')),
  ('075d9d1f37299ce1', parse_time('2015-01-21 20:51:56')),
  ('6f5f3596aa4517f0', parse_time('2015-01-21 20:51:57')),
  ('efc9f803c794c74d', parse_time('2015-01-21 20:53:43')),
  ('2dfb76d84f4ebde6', parse_time('2015-01-21 20:53:44')),
  ('2b60792760a1291c', parse_time('2015-01-21 20:53:45')),
  ('df9798c024d53f22', parse_time('2015-01-21 21:16:57')),
  ('4e30d62669c312dd', parse_time('2015-01-21 21:18:35')),
  ('e6867c0023bc8ba7', parse_time('2015-01-21 21:20:10')),
  ('44f23a85d786b4aa', parse_time('2015-01-21 21:26:54')),
  ('e416dff2dcefa69f', parse_time('2015-01-21 21:28:22')),
  ('5a36bfe017b8c440', parse_time('2015-01-21 21:29:56')),
  ('27bd482c7dd2e4b0', parse_time('2015-01-21 21:47:32')),
  ('156733dbbc0068b3', parse_time('2015-01-21 21:53:06')),
  ('e0a7b6fde4d924dd', parse_time('2015-01-21 21:55:04')),
  ('277d5afcf3d90017', parse_time('2015-01-21 21:55:05')),
  ('b20aa015fdfe75da', parse_time('2015-01-21 21:56:45')),
  ('a141109f58a13bda', parse_time('2015-01-21 21:58:28')),
  ('a2f6d748a24879d0', parse_time('2015-01-21 21:58:29')),
  ('25d61fca28d2ca5b', parse_time('2015-01-21 22:00:03')),
  ('a93644fa5e6b9741', parse_time('2015-01-21 22:01:29')),
  ('96f8d4195135b5ba', parse_time('2015-01-21 22:03:09')),
  ('b132ccda867e4fc8', parse_time('2015-01-21 22:03:10')),
  ('4bc5eddd850f1e72', parse_time('2015-01-21 22:05:41')),
  ('04094bf706d970f1', parse_time('2015-01-21 22:08:32')),
  ('dc779baf018e7ef4', parse_time('2015-01-21 22:10:08')),
  ('7e344d5d59ca302e', parse_time('2015-01-21 22:10:09')),
  ('3e12039f6acccefc', parse_time('2015-01-21 22:11:43')),
  ('2cb31f691a4357d7', parse_time('2015-01-21 22:13:17')),
  ('d2b1fcfa150c2e1c', parse_time('2015-01-21 22:13:18')),
  ('88bfd0c0b318796a', parse_time('2015-01-21 22:18:38')),
  ('09525e37b15fad83', parse_time('2015-01-21 22:24:47')),
  ('520e6bb69cb0b2fa', parse_time('2015-01-21 22:26:49')),
  ('0055a3a72acc45fb', parse_time('2015-01-21 22:29:33')),
  ('24fd209fd5257d3e', parse_time('2015-01-21 22:31:15')),
  ('b7b07fd149ac2b41', parse_time('2015-01-21 22:36:41')),
  ('96fcf6d0c177153a', parse_time('2015-01-21 22:38:25')),
  ('3390495d5d269e22', parse_time('2015-01-21 22:43:01')),
  ('f946e2446a58f44e', parse_time('2015-01-21 22:44:40')),
  ('17e8905123503b7f', parse_time('2015-01-21 22:44:41')),
  ('bbc23e733485b6ef', parse_time('2015-01-21 22:50:15')),
  ('1ca44b0b642e3479', parse_time('2015-01-21 22:58:28')),
  ('3b7678d024158307', parse_time('2015-01-21 23:05:44')),
  ('a2e3cc7a3586e7a2', parse_time('2015-01-21 23:11:27')),
  ('60f701a21bd61db8', parse_time('2015-01-21 23:16:39')),
  ('f3e52af4a756df54', parse_time('2015-01-21 23:19:45')),
  ('ae57221ff2622f1e', parse_time('2015-01-21 23:23:38')),
  ('50b8f236ff3db16d', parse_time('2015-01-21 23:27:45')),
  ('b6274c806784b2af', parse_time('2015-01-21 23:31:49')),
  ('d030c2a71609cb99', parse_time('2015-01-21 23:37:17')),
  ('c92575be237e9766', parse_time('2015-01-21 23:58:27')),
)
